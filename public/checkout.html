<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Premium Book Store</title>
  <link rel="stylesheet" href="css/output.css">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body class="bg-gray-100">
  <nav class="bg-indigo-600 text-white p-4">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold">Premium Book Store</h1>
      <a href="cart.html" class="text-white">Back to Cart</a>
    </div>
  </nav>

  <div class="container mx-auto py-8">
    <h2 class="text-3xl font-bold text-center mb-8">Checkout</h2>
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
      <h3 id="order-total" class="text-xl font-bold mb-4">Total: ₹0</h3>
      <form id="payment-form" class="space-y-4">
        <div>
          <label for="name" class="block text-gray-700">Name</label>
          <input id="name" type="text" class="w-full p-2 border rounded-md" required>
        </div>
        <div>
          <label for="email" class="block text-gray-700">Email</label>
          <input id="email" type="email" class="w-full p-2 border rounded-md" required>
        </div>
        <div>
          <label for="phone" class="block text-gray-700">Phone</label>
          <input id="phone" type="tel" class="w-full p-2 border rounded-md" required>
        </div>
        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700">Pay Now</button>
      </form>
    </div>
  </div>

  <script src="js/script.js"></script>
  <script>
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
    document.getElementById('order-total').textContent = `Total: ₹${total}`;

    document.getElementById('payment-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;

      try {
        const response = await fetch('/api/create-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount: total * 100, currency: 'INR' }),
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`API error: ${response.status} - ${errorText}`);
        }

        const order = await response.json();

        const options = {
          key: 'rzp_test_YourTestKey', // Use test key: https://dashboard.razorpay.com/app/keys
          amount: order.amount,
          currency: order.currency,
          name: 'Premium Book Store',
          description: 'Book Purchase',
          order_id: order.id,
          handler: function (response) {
            alert(`Payment successful! Payment ID: ${response.razorpay_payment_id}`);
            localStorage.removeItem('cart');
            window.location.href = 'index.html';
          },
          prefill: { name, email, contact: phone },
          theme: { color: '#4F46E5' },
        };
        const rzp = new Razorpay(options);
        rzp.on('payment.failed', function (response) {
          alert(`Payment failed: ${response.error.description}`);
        });
        rzp.open();
      } catch (error) {
        console.error('Payment error:', error);
        alert(`Error: ${error.message}. Please check the console and try again.`);
      }
    });
  </script>
</body>
</html>
