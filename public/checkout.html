<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Premium Book Store</title>
  <link rel="stylesheet" href="css/output.css">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body class="bg-gray-50 text-book-primary">
  <nav class="bg-book-primary text-white shadow-lg">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="flex items-center space-x-2">
        <img src="images/logo.png" alt="Logo" class="h-8">
        <h1 class="text-2xl font-merriweather">Premium Book Store</h1>
      </a>
      <div class="flex items-center space-x-6">
        <a href="index.html" class="hover:text-book-accent">Home</a>
        <a href="cart.html" class="hover:text-book-accent">Cart</a>
      </div>
    </div>
  </nav>

  <section class="container mx-auto px-4 py-12">
    <h2 class="text-3xl font-merriweather text-center mb-8">Checkout</h2>
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-md">
      <h3 id="order-total" class="text-xl font-merriweather mb-6">Total: ₹0</h3>
      <form id="payment-form" class="space-y-4">
        <div>
          <label for="name" class="block text-sm font-medium">Name</label>
          <input id="name" type="text" class="w-full p-2 border rounded-md focus:ring-book-accent focus:border-book-accent" required>
        </div>
        <div>
          <label for="email" class="block text-sm font-medium">Email</label>
          <input id="email" type="email" class="w-full p-2 border rounded-md focus:ring-book-accent focus:border-book-accent" required>
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium">Phone</label>
          <input id="phone" type="tel" class="w-full p-2 border rounded-md focus:ring-book-accent focus:border-book-accent" required>
        </div>
        <button type="submit" class="w-full bg-book-accent text-white py-2 rounded-md hover:bg-amber-600">Pay Now</button>
      </form>
    </div>
  </section>

  <footer class="bg-book-primary text-white py-8">
    <div class="container mx-auto px-4 text-center">
      <p>&copy; 2025 Premium Book Store. All rights reserved.</p>
    </div>
  </footer>

  <script src="js/script.js"></script>
  <script>
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
    document.getElementById('order-total').textContent = `Total: ₹${total}`;

    document.getElementById('payment-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;

      if (typeof Razorpay === 'undefined') {
        alert('Failed to load Razorpay SDK. Please check your network.');
        return;
      }

      try {
        const response = await fetch('/api/create-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount: total * 100, currency: 'INR' }),
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`API error: ${response.status} - ${errorText}`);
        }

        const order = await response.json();

        const options = {
          key: 'rzp_test_YOUR_TEST_KEY', // Replace with your Razorpay test key
          amount: order.amount,
          currency: order.currency,
          name: 'Premium Book Store',
          description: 'Book Purchase',
          order_id: order.id,
          handler: function (response) {
            alert(`Payment successful! Payment ID: ${response.razorpay_payment_id}`);
            localStorage.removeItem('cart');
            window.location.href = 'index.html';
          },
          prefill: { name, email, contact: phone },
          theme: { color: '#D97706' },
        };

        const rzp = new Razorpay(options);
        rzp.on('payment.failed', function (response) {
          alert(`Payment failed: ${response.error.description}`);
        });
        rzp.open();
      } catch (error) {
        console.error('Payment error:', error);
        alert(`Error: ${error.message}. Please check the console or try again.`);
      }
    });
  </script>
</body>
</html>
